---
- pipeline:
    name: check
    manager: independent
    precedence: low
    trigger:
      github:
        - event: pull_request
          action:
            - opened
            - changed
            - reopened
        - event: pull_request
          action: comment
          comment: (?i)^\s*recheck\s*$
    start:
      github:
        status: pending
        comment: false
    success:
      sql:
      github:
        status: success
    failure:
      sql:
      github:
        status: failure

- pipeline:
    name: gate
    manager: dependent
    precedence: high
    require:
      github:
        status: "zuul-by-vexxhost-inc\\[bot\\]:.*/check:success"
        open: True
        current-patchset: True
        review:
        - type: approved
          permission: write
    trigger:
      github:
        - event: pull_request_review
          action: submitted
          state: approved
        - event: pull_request
          action: comment
          comment: (?i)^\s*lgtm\s*$
        - event: pull_request
          action: comment
          comment: (?i)^\s*shipit\s*$
        - event: pull_request
          action: status
          status: "zuul-by-vexxhost-inc\\[bot\\]:.*/check:success"
    start:
      github:
        status: pending
        comment: false
    success:
      sql:
      github:
        status: success
        merge: true
    failure:
      sql:
      github:
        status: failure

